<?xml version="1.0" encoding="UTF-8"?>
<diagram name="control_flowchart">
    <![CDATA[
╔═══════════════════════════════════════════════════════════════════════════╗
║                   CONTROL ALGORITHM BLOCK DIAGRAM                         ║
╚═══════════════════════════════════════════════════════════════════════════╝


                              ┌──────────────┐
                              │    START     │
                              └──────┬───────┘
                                     │
                                     ▼
                    ┌────────────────────────────────┐
                    │     Initialize System          │
                    │  ESP32, Sensors, LCD, WiFi     │
                    └────────────┬───────────────────┘
                                 │
                                 ▼
                   ┌─────────────────────────────────┐
                   │          MAIN LOOP              │◄────┐
                   └─────────────┬───────────────────┘     │
                                 │                         │
                                 ▼                         │
                    ┌────────────────────────────────┐     │
                    │   READ ALL SENSORS             │     │
                    │  • Soil Moisture               │     │
                    │  • Rain                        │     │
                    │  • pH                          │     │
                    │  • Temperature                 │     │
                    │  • Humidity                    │     │
                    └────────────┬───────────────────┘     │
                                 │                         │
                                 ▼                         │
                    ┌────────────────────────────────┐     │
                    │   PRIORITY 1:                  │     │
                    │   Rain Override Check          │     │
                    └────────────┬───────────────────┘     │
                                 │                         │
                    ┌────────────┴────────────┐            │
                    │                         │            │
                    ▼                         ▼            │
              ┌──────────┐             ┌──────────┐        │
              │   Rain   │             │  No Rain │        │
              │ Detected │             └─────┬────┘        │
              └─────┬────┘                   │            │
                    │                        │            │
                    ▼                        ▼            │
              ┌──────────┐      ┌────────────────────┐    │
              │ Pump OFF │      │   PRIORITY 2:      │    │
              │(Override)│      │Hysteresis Control  │    │
              └─────┬────┘      └──────────┬─────────┘    │
                    │                      │              │
                    │           ┌──────────┴──────────┐   │
                    │           │                     │   │
                    │           ▼                     ▼   │
                    │     ┌──────────┐         ┌──────────┐
                    │     │ M < 30%  │         │ M > 60%  │
                    │     └─────┬────┘         └─────┬────┘
                    │           │                    │   │
                    │           ▼                    ▼   │
                    │     ┌──────────┐         ┌──────────┐
                    │     │ Pump ON  │         │ Pump OFF │
                    │     └─────┬────┘         └─────┬────┘
                    │           │                    │   │
                    │           └──────────┬─────────┘   │
                    │                      │             │
                    │           ┌──────────┴──────────┐  │
                    │           │    30% ≤ M ≤ 60%    │  │
                    │           │    HOLD STATE       │  │
                    │           └──────────┬──────────┘  │
                    │                      │             │
                    └──────────────────────┘             │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   PRIORITY 3:                  │   │
                    │   Warning Checks               │   │
                    │  • pH (5.5-7.5)                │   │
                    │  • Temp (< 35°C)               │   │
                    │  → Yellow LED if out of range  │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   UPDATE DISPLAY               │   │
                    │  • LCD (Moisture, pH, Temp)    │   │
                    │  • Red LED (Pump)              │   │
                    │  • Green LED (WiFi)            │   │
                    │  • Blue LED (Upload)           │   │
                    │  • Yellow LED (Warning)        │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   CLOUD UPLOAD                 │   │
                    │  (if WiFi connected            │   │
                    │   and 30s elapsed)             │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   DELAY 2 seconds              │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 └───────────────────────┘
    ]]>
</diagram>
