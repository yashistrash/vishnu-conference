<?xml version="1.0" encoding="UTF-8"?>
<diagrams>
    <diagram name="control_flowchart">
        <![CDATA[
╔═══════════════════════════════════════════════════════════════════════════╗
║                   CONTROL ALGORITHM BLOCK DIAGRAM                         ║
╚═══════════════════════════════════════════════════════════════════════════╝


                              ┌──────────────┐
                              │    START     │
                              └──────┬───────┘
                                     │
                                     ▼
                    ┌────────────────────────────────┐
                    │     Initialize System          │
                    │  ESP32, Sensors, LCD, WiFi     │
                    └────────────┬───────────────────┘
                                 │
                                 ▼
                   ┌─────────────────────────────────┐
                   │          MAIN LOOP              │◄────┐
                   └─────────────┬───────────────────┘     │
                                 │                         │
                                 ▼                         │
                    ┌────────────────────────────────┐     │
                    │   READ ALL SENSORS             │     │
                    │  • Soil Moisture               │     │
                    │  • Rain                        │     │
                    │  • pH                          │     │
                    │  • Temperature                 │     │
                    │  • Humidity                    │     │
                    └────────────┬───────────────────┘     │
                                 │                         │
                                 ▼                         │
                    ┌────────────────────────────────┐     │
                    │   PRIORITY 1:                  │     │
                    │   Rain Override Check          │     │
                    └────────────┬───────────────────┘     │
                                 │                         │
                    ┌────────────┴────────────┐            │
                    │                         │            │
                    ▼                         ▼            │
              ┌──────────┐             ┌──────────┐        │
              │   Rain   │             │  No Rain │        │
              │ Detected │             └─────┬────┘        │
              └─────┬────┘                   │            │
                    │                        │            │
                    ▼                        ▼            │
              ┌──────────┐      ┌────────────────────┐    │
              │ Pump OFF │      │   PRIORITY 2:      │    │
              │(Override)│      │Hysteresis Control  │    │
              └─────┬────┘      └──────────┬─────────┘    │
                    │                      │              │
                    │           ┌──────────┴──────────┐   │
                    │           │                     │   │
                    │           ▼                     ▼   │
                    │     ┌──────────┐         ┌──────────┐
                    │     │ M < 30%  │         │ M > 60%  │
                    │     └─────┬────┘         └─────┬────┘
                    │           │                    │   │
                    │           ▼                    ▼   │
                    │     ┌──────────┐         ┌──────────┐
                    │     │ Pump ON  │         │ Pump OFF │
                    │     └─────┬────┘         └─────┬────┘
                    │           │                    │   │
                    │           └──────────┬─────────┘   │
                    │                      │             │
                    │           ┌──────────┴──────────┐  │
                    │           │    30% ≤ M ≤ 60%    │  │
                    │           │    HOLD STATE       │  │
                    │           └──────────┬──────────┘  │
                    │                      │             │
                    └──────────────────────┘             │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   PRIORITY 3:                  │   │
                    │   Warning Checks               │   │
                    │  • pH (5.5-7.5)                │   │
                    │  • Temp (< 35°C)               │   │
                    │  → Yellow LED if out of range  │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   UPDATE DISPLAY               │   │
                    │  • LCD (Moisture, pH, Temp)    │   │
                    │  • Red LED (Pump)              │   │
                    │  • Green LED (WiFi)            │   │
                    │  • Blue LED (Upload)           │   │
                    │  • Yellow LED (Warning)        │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   CLOUD UPLOAD                 │   │
                    │  (if WiFi connected            │   │
                    │   and 30s elapsed)             │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 ▼                       │
                    ┌────────────────────────────────┐   │
                    │   DELAY 2 seconds              │   │
                    └────────────┬───────────────────┘   │
                                 │                       │
                                 └───────────────────────┘
        ]]>
    </diagram>
    <diagram name="hysteresis_control">
        <![CDATA[
╔═══════════════════════════════════════════════════════════════════════════╗
║              HYSTERESIS CONTROL: DUAL-THRESHOLD ALGORITHM                 ║
╚═══════════════════════════════════════════════════════════════════════════╝


                        HYSTERESIS CONTROL BLOCK
    ┌─────────────────────────────────────────────────────────────┐
    │                                                             │
    │                     ┌────────────────┐                      │
    │                     │  Soil Moisture │                      │
    │                     │   Sensor (M)   │                      │
    │                     └────────┬───────┘                      │
    │                              │                              │
    │                              ▼                              │
    │            ┌─────────────────────────────────┐              │
    │            │   Moisture Value M(t)           │              │
    │            └─────────┬───────────────────────┘              │
    │                      │                                      │
    │       ┌──────────────┼──────────────┐                       │
    │       │              │              │                       │
    │       ▼              ▼              ▼                       │
    │  ┌────────┐    ┌─────────┐    ┌────────┐                   │
    │  │ M < 30%│    │30%≤M≤60%│    │ M > 60%│                   │
    │  └───┬────┘    └────┬────┘    └────┬───┘                   │
    │      │              │              │                       │
    │      ▼              ▼              ▼                       │
    │  ┌────────┐    ┌─────────┐    ┌────────┐                   │
    │  │Pump=ON │    │Pump=HOLD│    │Pump=OFF│                   │
    │  └───┬────┘    └────┬────┘    └────┬───┘                   │
    │      │              │              │                       │
    │      └──────────────┼──────────────┘                       │
    │                     │                                      │
    │                     ▼                                      │
    │           ┌──────────────────┐                             │
    │           │  Pump State P(t) │                             │
    │           └──────────────────┘                             │
    │                                                            │
    └────────────────────────────────────────────────────────────┘


                      STATE TRANSITION DIAGRAM
    ┌─────────────────────────────────────────────────────────────┐
    │                                                             │
    │         Moisture > 60%                                      │
    │    ┌───────────────────────────────┐                        │
    │    │                               │                        │
    │    │                               ▼                        │
    │ ┌──┴──────┐   30% ≤ M ≤ 60%   ┌─────────┐                  │
    │ │  PUMP   │◄──────────────────│  PUMP   │                  │
    │ │  OFF    │                   │   OFF   │                  │
    │ │ (State  │                   │ (State  │                  │
    │ │   0)    │                   │   0)    │                  │
    │ └──┬──────┘                   └─────────┘                  │
    │    │                              ▲                        │
    │    │ Moisture < 30%               │                        │
    │    │                              │                        │
    │    ▼                              │                        │
    │ ┌─────────┐   30% ≤ M ≤ 60%   ┌──┴──────┐                  │
    │ │  PUMP   │──────────────────►│  PUMP   │                  │
    │ │  ON     │                   │   ON    │                  │
    │ │ (State  │                   │ (State  │                  │
    │ │   1)    │                   │   1)    │                  │
    │ └─────────┘                   └─────────┘                  │
    │    ▲                              │                        │
    │    │                              │                        │
    │    └──────────────────────────────┘                        │
    │         Moisture < 30%                                     │
    │                                                            │
    └────────────────────────────────────────────────────────────┘


                    DECISION PRIORITY HIERARCHY
    ┌─────────────────────────────────────────────────────────────┐
    │                                                             │
    │  ┌────────────────────────────────────────────────┐         │
    │  │      PRIORITY 1: Rain Override                 │         │
    │  │   IF (Rain == DETECTED) → Pump = OFF           │         │
    │  └──────────────────┬─────────────────────────────┘         │
    │                     │                                       │
    │                     ▼ No Rain                               │
    │  ┌────────────────────────────────────────────────┐         │
    │  │      PRIORITY 2: Hysteresis Control            │         │
    │  │   IF (M < 30%)   → Pump = ON                   │         │
    │  │   IF (M > 60%)   → Pump = OFF                  │         │
    │  │   IF (30%≤M≤60%) → Pump = HOLD                 │         │
    │  └──────────────────┬─────────────────────────────┘         │
    │                     │                                       │
    │                     ▼                                       │
    │  ┌────────────────────────────────────────────────┐         │
    │  │      PRIORITY 3: Warning Indicators            │         │
    │  │   IF (pH out of 5.5-7.5)  → Yellow LED         │         │
    │  │   IF (Temp > 35°C)        → Yellow LED         │         │
    │  └────────────────────────────────────────────────┘         │
    │                                                             │
    └─────────────────────────────────────────────────────────────┘
        ]]>
    </diagram>
    <diagram name="system_architecture">
        <![CDATA[
╔═══════════════════════════════════════════════════════════════════════════╗
║                    THREE-TIER SYSTEM ARCHITECTURE                         ║
╚═══════════════════════════════════════════════════════════════════════════╝


                            SENSING LAYER
    ┌──────────────────────────────────────────────────────────────┐
    │                                                              │
    │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
    │  │ Capacitive   │  │    Rain      │  │     pH       │      │
    │  │ Soil Moisture│  │   Sensor     │  │   Sensor     │      │
    │  │   Sensor     │  │              │  │              │      │
    │  │   0-100%     │  │   Digital    │  │  pH 0-14     │      │
    │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
    │         │                 │                 │              │
    │  ┌──────┴─────────────────┴─────────────────┴──────┐       │
    │  │              ┌──────────────┐                    │       │
    │  │              │    DHT22     │                    │       │
    │  │              │ Temperature  │                    │       │
    │  │              │ & Humidity   │                    │       │
    │  │              └──────┬───────┘                    │       │
    │  └─────────────────────┼────────────────────────────┘       │
    │                        │                                    │
    │     └────────────────────────┼────────────────────────────────────┘
    │                              │
    │                              ▼
    │                     ┌────────────────┐
    │                     │   GPIO Pins    │
    │                     │  34,35,36,4    │
    │                     └────────┬───────┘
    │                              │
    │                              ▼
    │     ┌────────────────────────────────────────────────────────────┐
    │     │                   PROCESSING LAYER                         │
    │     │                                                            │
    │     │              ┌───────────────────────┐                     │
    │     │              │    ESP32-WROOM-32     │                     │
    │     │              │ Dual-Core 240MHz      │                     │
    │     │              │ 520KB SRAM, WiFi      │                     │
    │     │              └───────────┬───────────┘                     │
    │     │                          │                                 │
    │     │        ┌─────────────────┼─────────────────┐               │
    │     │        │                 │                 │               │
    │     │        ▼                 ▼                 ▼               │
    │     │  ┌──────────┐    ┌──────────┐    ┌──────────┐             │
    │     │  │   Data   │    │Irrigation│    │   WiFi   │             │
    │     │  │Acquisition    │ Control  │    │   Comm   │             │
    │     │  │  Module  │    │ Module   │    │  Module  │             │
    │     │  └────┬─────┘    └────┬─────┘    └────┬─────┘             │
    │     │       │               │               │                   │
    │     │       └───────────────┼───────────────┘                   │
    │     │                       │                                   │
    │     └───────────────────────┼───────────────────────────────────┘
    │                             │
    │                             ▼
    │     ┌───────────────────────────────────────────────────────────┐
    │     │                   ACTUATION LAYER                         │
    │     │                                                           │
    │     │   ┌─────────────────┐       ┌─────────────────┐          │
    │     │   │  Local Display  │       │ Cloud Interface │          │
    │     │   │                 │       │                 │          │
    │     │   │  ┌───────────┐  │       │  ┌───────────┐  │          │
    │     │   │  │ 16×2 LCD  │  │       │  │   WiFi    │  │          │
    │     │   │  │ (I2C)     │  │       │  │  Network  │  │          │
    │     │   │  └───────────┘  │       │  └─────┬─────┘  │          │
    │     │   │                 │       │        │        │          │
    │     │   │  ┌───────────┐  │       │        ▼        │          │
    │     │   │  │ 4× LEDs   │  │       │  ┌───────────┐  │          │
    │     │   │  │ R/G/B/Y   │  │       │  │  Cloud    │  │          │
    │     │   │  └───────────┘  │       │  │  Server   │  │          │
    │     │   │                 │       │  └───────────┘  │          │
    │     │   │  ┌───────────┐  │       │                 │          │
    │     │   │  │   Pump    │  │       │                 │          │
    │     │   │  │  Control  │  │       │                 │          │
    │     │   │  └───────────┘  │       │                 │          │
    │     │   └─────────────────┘       └─────────────────┘          │
    │     │                                                           │
    │     └───────────────────────────────────────────────────────────┘
        ]]>
    </diagram>
</diagrams>
